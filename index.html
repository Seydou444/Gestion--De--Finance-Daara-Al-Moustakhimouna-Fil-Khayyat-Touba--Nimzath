<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>DAARA AL MOUSTAKHIMOUNA | Officiel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --wave-blue: #1dcaff;
            --primary: #27ae60;
            --danger: #e74c3c;
            --dark: #2d3436;
            --warning: #3498db;
        }

        body { font-family: 'Poppins', sans-serif; background: purple; margin: 0; min-height: 100vh; }

        header {
            display: flex; justify-content: space-between; align-items: center; 
            padding: 15px 30px; background: linear-gradient(90deg, #3498db, #2ecc71); 
            color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        header h1 { flex: 1; text-align: center; font-size: 18px; font-weight: 800; margin: 0; }
        header img { height: 60px; width: 60px; border-radius: 12px; border: 2px solid yellowgreen; object-fit: cover; }

        .container { max-width: 1300px; margin: 30px auto; padding: 0 20px; }

        /* Indicateur Live */
        .live-tag { text-align: center; color: #2ecc71; font-size: 11px; font-weight: 800; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .dot { width: 8px; height: 8px; background: #2ecc71; border-radius: 50%; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .stat-card { background: blueviolet; padding: 20px; border-radius: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); color:white; }
        .stat-value { font-size: 1.4rem; font-weight: 800; color: var(--wave-blue); }
        .stat-letters { font-size: 0.85rem; font-style: italic; color: #fdfdfd; margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 5px; text-transform: uppercase; }

        .admin-only-stats { display: none; }
        .admin-top-bar { text-align: center; margin-bottom: 30px; display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .search-bar {
            width: 100%; max-width: 500px; display: block; margin: 0 auto 40px auto;
            padding: 15px 25px; border-radius: 50px; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.2); font-size: 16px; outline: none;
        }

        .members-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(310px, 1fr)); gap: 30px; }
        
        /* CARTE MEMBRE (VOTRE DESIGN) */
        .member-card {
            background:bisque; border-radius: 35px; padding: 45px 20px 25px 20px; text-align: center; 
            box-shadow: 0 12px 35px rgba(0,0,0,0.1); position: relative; overflow: hidden;
        }

        .card-logo {
            position: absolute; top: 10px; right: 10px; width: 65px; height: 65px; 
            border-radius: 15px; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); object-fit: cover; z-index: 10;
        }

        .photo-container {
            width: 160px; height: 160px; margin: 15px auto 20px auto;
            border-radius: 50%; border: 8px solid #eee; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.15); overflow: hidden; background: #f8f9fa;
        }
        .photo-container img { width: 100%; height: 100%; object-fit: cover; object-position: center 15%; }

        .border-green { border-color: var(--primary) !important; }
        .border-blue { border-color: var(--warning) !important; }
        .border-red { border-color: var(--danger) !important; }

        .member-name { font-size: 20px; font-weight: 800; margin-bottom: 20px; color: var(--dark); min-height: 50px; display: flex; align-items: center; justify-content: center; }

        .payment-status { display: flex; gap: 8px; }
        .pay-box { flex: 1; padding: 12px 5px; border-radius: 22px; background: #f8f9fa; font-size: 11px; font-weight: 700; color: #333; line-height: 1.5; }
        .reste-txt { color: var(--danger); font-size: 12px; display: block; margin-top: 2px; border-top: 1px solid #ddd; padding-top: 2px; }
        
        .status-badge { display: inline-block; padding: 4px 10px; border-radius: 50px; color: white; font-size: 9px; margin-top: 5px; }
        .bg-red { background: var(--danger); }
        .bg-blue { background: #3498db; }
        .bg-green { background: var(--primary); }

        .btn-wave { width: 100%; margin-top: 20px; padding: 14px; border-radius: 18px; border: none; background: var(--wave-blue); color: white; font-weight: 800; cursor: pointer; }

        /* ZONE ADMIN MISE √Ä JOUR */
        .admin-zone { margin-top: 15px; display: flex; flex-direction: column; gap: 8px; border-top: 1px dashed #ccc; padding-top: 15px; }
        .admin-label { font-size: 10px; font-weight: 800; color: #555; }
        .admin-input { padding: 10px; border-radius: 12px; border: 1px solid #ddd; text-align: center; font-family: 'Poppins'; font-weight: 800; background: white; }

        #loader { position: fixed; bottom: 20px; right: 20px; font-weight: 800; color: var(--primary); background: white; padding: 10px 20px; border-radius: 50px; display: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 5000; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 3000; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 90%; max-width: 400px; border-radius: 40px; padding: 40px; text-align: center; }
    </style>
</head>
<body>

<div id="loader">üîÑ SAUVEGARDE...</div>

<header>
    <img src="images/A.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=D&background=fff&color=2ecc71'">
    <h1> GESTION DE FINANCE DAARA AL MOUSTAKHIMOUNA</h1>
    <img src="images/A.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=D&background=fff&color=2ecc71'">
</header>

<div class="container">
    <div class="live-tag"><div class="dot"></div> SYNCHRONISATION LIVE (1S)</div>

    <div class="stats-grid">
        <div class="stat-card">
            <h3>Reste Total √† payer</h3>
            <div class="stat-value" id="detteGlobale">-</div>
            <div class="stat-letters" id="detteEnLettres">Z√âRO FRANC CFA</div>
        </div>
        <div class="stat-card admin-only-stats" id="cardAdyya"><h3>Total Adyya</h3><div class="stat-value" id="totalAdyya">-</div></div>
        <div class="stat-card admin-only-stats" id="cardQuinzaine"><h3>Total Quinzaine</h3><div class="stat-value" id="totalQuinzaine">-</div></div>
    </div>

    <div class="admin-top-bar">
        <button onclick="toggleAdmin()" id="adminBtn" style="padding: 14px 30px; border-radius: 50px; border: none; background: var(--dark); color: white; font-weight: 800; cursor: pointer;">üîê ESPACE RESPONSABLE</button>
        <button onclick="initialiserTout()" id="resetBtn" style="display:none; background:white; color:red; border:2px solid red; padding:8px 20px; border-radius:50px; cursor:pointer; font-weight:800; margin-top:10px;">‚ö†Ô∏è R√âINITIALISER TOUT</button>
    </div>

    <input type="text" id="searchInput" class="search-bar" onkeyup="render()" placeholder="üîç Rechercher un membre...">
    <div class="members-grid" id="membersGrid"></div>
</div>

<div class="modal-overlay" id="waveModal">
    <div class="modal-content">
        <h2 style="color:var(--wave-blue);">üåä Paiement Wave</h2>
        <div style="text-align:left; margin: 20px 0;">
            <p>Seydou Sall : <b>77 462 95 28</b></p>
            <p>Malick Sarr : <b>78 122 37 73</b></p>
            <p>Ibrahima Sanokho : <b>77 256 70 34</b></p>
            <p>Khadidiatou Sall : <b>78 787 01 58</b></p>
        </div>
        <button onclick="document.getElementById('waveModal').style.display='none'" style="padding:12px 40px; border-radius:50px; border:none; background:var(--dark); color:white; cursor:pointer; font-weight:800;">RETOUR</button>
    </div>
</div>

<script>
    const API_URL = "https://api.npoint.io/cf1eee9c96d506fc8eef";
    const SECRET = "1234ABCD@";
    const OBJ = 10000;
    let isAdmin = false;
    let dataStore = [];
    let isSaving = false;

    const noms = ["Dieuwrigne Omar Ndaw", "Dieuwrigne Abdou Khoudoss Ngom", "Dieuwrigne Cheikh Ciss√©", "Dieuwrigne Malick Sarr", "Dieuwrigne Madiagne Sidib√©", "Dieuvrigne Abdoulaye Sall", "Dieuwrigne Idrissa ben Abdoulaye Diouf", "Dieuwrigne Ibrahima Sanokho", "Dieuwrigne Moussa Sarr", "Dieuwrigne Cheikh Sall", "Dieuwrigne Ousmane Sall", "Dieuwrigne Mouhamed Ngom", "Dieuwrigne Omar Sanokho Al Farokh", "Diewrigne Ousmane Sanokho", "Dieuwrigne Mamadou FALL", "Dieuwrigne Birane Diop", "Dieuwrigne Bassirou Ciss√©", "Dieuwrigne Pape Mass√©ne S√©ne", "Dieuwrigne Ibrahima diarra", "Dieuwrigne Mamady Fall Ndaw", "Dieuwrigne Seydou Sall", "Dieuwrigne Mouhamed Sall", "Dieuwrigne Cheikh Mback√©", "Dieuwrigne Sidi Sall", "Dieuwrigne Pape Sow sall", "Dieuwrigne Fallou Diop", "Dieuwrigne Mouhamed Diao", "Dieuwrigne Saliou Seck", "Sokhna Di√©yenaba Diop", "Sokhna Safi√©tou Sarr", "Sokhna Khadidiatou Sall", "Sokhna Adama Sarr", "Sokhna Nd√©ye Mbaye", "Sokhna Nd√©ye Camara", "Sokhna Awa Yacine Fall", "Sokhna Paya Tour√©", "Sokhna Sofia Diao", "Sokhna Ya Mari√©me Sall", "Sokhna Fily Traor√©", "Sokhna Fatou Camara", "Sokhna Rokhaya Sall", "Sokhna Awa Camara"];

    function nombreEnLettres(n) {
        if (n <= 0) return "Z√âRO FRANC CFA";
        const units = ["", "un", "deux", "trois", "quatre", "cinq", "six", "sept", "huit", "neuf"];
        const tens = ["", "dix", "vingt", "trente", "quarante", "cinquante", "soixante", "soixante-dix", "quatre-vingt", "quatre-vingt-dix"];
        const special = {11:"onze", 12:"douze", 13:"treize", 14:"quatorze", 15:"quinze", 16:"seize"};

        function conv(num) {
            if (num < 10) return units[num];
            if (num >= 11 && num <= 16) return special[num];
            if (num < 100) {
                let t = Math.floor(num/10), u = num%10;
                if (t===7 || t===9) return tens[t-1] + "-" + (u===1?"et-":"") + conv(u+10);
                return tens[t] + (u===1?"-et-":(u>0?"-":"")) + units[u];
            }
            if (num < 1000) {
                let c = Math.floor(num/100), r = num%100;
                return (c===1?"":units[c]+" ")+"cent"+(r>0?" "+conv(r):"");
            }
            if (num < 1000000) {
                let m = Math.floor(num/1000), r = num%1000;
                return (m===1?"":conv(m)+" ")+"mille"+(r>0?" "+conv(r):"");
            }
            return num;
        }
        return conv(n).toUpperCase() + " FRANCS CFA";
    }

    async function sync() {
        if (isSaving) return;
        try {
            const r = await fetch(`${API_URL}?t=${Date.now()}`);
            const d = await r.json();
            if (JSON.stringify(d) !== JSON.stringify(dataStore)) {
                dataStore = d; render();
            }
        } catch(e) {}
    }

    async function saveData() {
        isSaving = true;
        document.getElementById('loader').style.display = 'block';
        try {
            await fetch(API_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(dataStore)
            });
        } catch(e) { alert("Erreur r√©seau"); }
        document.getElementById('loader').style.display = 'none';
        isSaving = false;
    }

    async function autoSave(id, type, val) {
        let m = dataStore.find(x => x.id === id);
        if (!m) { m = {id, a:0, q:0}; dataStore.push(m); }
        m[type] = parseInt(val) || 0;
        render();
        await saveData();
    }

    function toggleAdmin() {
        if (!isAdmin) {
            if (prompt("Code secret :") === SECRET) {
                isAdmin = true;
                document.getElementById('adminBtn').style.background = "red";
                document.getElementById('resetBtn').style.display = "inline-block";
                document.querySelectorAll('.admin-only-stats').forEach(s => s.style.display="block");
            }
        } else {
            isAdmin = false;
            document.getElementById('adminBtn').style.background = "#2d3436";
            document.getElementById('resetBtn').style.display = "none";
            document.querySelectorAll('.admin-only-stats').forEach(s => s.style.display="none");
        }
        render();
    }

    function getStatus(reste) {
        if (reste <= 0) return { cl: "bg-green", bdr: "border-green", txt: "PAY√â ‚úÖ" };
        if (reste <= 5000) return { cl: "bg-blue", bdr: "border-blue", txt: "BIENT√îT üîµ" };
        return { cl: "bg-red", bdr: "border-red", txt: "RETARD üî¥" };
    }

    function render() {
        const grid = document.getElementById('membersGrid');
        const search = document.getElementById('searchInput').value.toLowerCase();
        grid.innerHTML = '';
        let rT=0, eA=0, eQ=0;

        noms.forEach((nom, i) => {
            const id = i + 1;
            const p = dataStore.find(x => x.id === id) || {id, a:0, q:0};
            const dA = Math.max(0, OBJ - p.a);
            const dQ = Math.max(0, OBJ - p.q);
            const rI = dA + dQ;
            const status = getStatus(rI);
            rT += rI; eA += p.a; eQ += p.q;

            if (nom.toLowerCase().includes(search)) {
                grid.innerHTML += `
                <div class="member-card">
                    <img src="images/A.jpeg" class="card-logo" onerror="this.src='https://ui-avatars.com/api/?name=D&background=fff&color=2ecc71'">
                    <div class="photo-container ${status.bdr}">
                        <img src="images/membre${id}.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(nom)}&background=random&size=250'">
                    </div>
                    <div class="member-name">${nom}</div>
                    <div class="payment-status">
                        <div class="pay-box">ADYYA<br>${p.a} / ${OBJ}F<span class="reste-txt">Reste: ${dA}F</span><span class="status-badge ${getStatus(dA).cl}">${getStatus(dA).txt}</span></div>
                        <div class="pay-box">QUINZAINE<br>${p.q} / ${OBJ}F<span class="reste-txt">Reste: ${dQ}F</span><span class="status-badge ${getStatus(dQ).cl}">${getStatus(dQ).txt}</span></div>
                    </div>
                    ${isAdmin ? `
                        <div class="admin-zone">
                            <span class="admin-label">TOTAL ADYYA</span>
                            <input type="number" value="${p.a}" onchange="autoSave(${id},'a',this.value)" class="admin-input">
                            <span class="admin-label">TOTAL QUINZAINE</span>
                            <input type="number" value="${p.q}" onchange="autoSave(${id},'q',this.value)" class="admin-input">
                        </div>
                    ` : `
                        <button class="btn-wave" onclick="document.getElementById('waveModal').style.display='flex'">INFOS PAIEMENT</button>
                    `}
                </div>`;
            }
        });
        document.getElementById('detteGlobale').innerText = rT.toLocaleString() + " F";
        document.getElementById('detteEnLettres').innerText = nombreEnLettres(rT);
        document.getElementById('totalAdyya').innerText = eA.toLocaleString() + " F";
        document.getElementById('totalQuinzaine').innerText = eQ.toLocaleString() + " F";
    }

    async function initialiserTout() {
        if(confirm("EFFACER TOUT ?")) {
            dataStore = noms.map((n, i) => ({id: i+1, a:0, q:0}));
            render(); await saveData();
        }
    }

    setInterval(sync, 1000);
    sync();
</script>
</body>
</html>