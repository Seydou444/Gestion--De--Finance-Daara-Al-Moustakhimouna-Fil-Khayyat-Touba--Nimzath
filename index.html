<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>DAARA AL MOUSTAKHIMOUNA | LIVE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --wave-blue: #1dcaff;
            --primary: #27ae60;
            --danger: #e74c3c;
            --dark: #2d3436;
        }
        body { font-family: 'Poppins', sans-serif; background: #2c3e50; margin: 0; min-height: 100vh; color: white; }
        
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 15px 20px; background: linear-gradient(90deg, #3498db, #2ecc71); 
            color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        header h1 { flex: 1; text-align: center; font-size: 14px; font-weight: 800; margin: 0; text-transform: uppercase; }
        header img { height: 50px; width: 50px; border-radius: 50%; border: 2px solid white; object-fit: cover; }

        .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }

        /* INDICATEUR LIVE CLIGNOTANT */
        .live-status { text-align: center; margin-bottom: 15px; font-size: 11px; font-weight: bold; color: #2ecc71; text-transform: uppercase; letter-spacing: 1px; }
        .dot { height: 10px; width: 10px; background-color: #2ecc71; border-radius: 50%; display: inline-block; margin-right: 5px; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 20px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.2); }
        .stat-value { font-size: 1.5rem; font-weight: 800; color: #f1c40f; }

        .admin-top-bar { text-align: center; margin-bottom: 25px; }
        .btn-admin-toggle { padding: 12px 25px; border-radius: 50px; border: none; background: #34495e; color: white; font-weight: 800; cursor: pointer; transition: 0.3s; }
        .btn-admin-toggle:hover { background: #2c3e50; transform: scale(1.05); }

        .search-bar { 
            width: 100%; max-width: 500px; display: block; margin: 0 auto 30px auto; 
            padding: 15px 25px; border-radius: 50px; border: none; font-size: 16px; outline: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .members-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        .member-card {
            background: white; border-radius: 25px; padding: 40px 15px 20px 15px; text-align: center; 
            position: relative; color: #2d3436; box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        .card-logo { position: absolute; top: 12px; right: 12px; width: 45px; height: 45px; border-radius: 8px; object-fit: cover; }
        
        .photo-container {
            width: 125px; height: 125px; margin: 0 auto 15px auto;
            border-radius: 50%; border: 5px solid #f0f0f0; overflow: hidden;
        }
        .border-green { border-color: var(--primary) !important; }
        .border-red { border-color: var(--danger) !important; }

        .member-name { font-size: 16px; font-weight: 800; color: #2c3e50; margin-bottom: 15px; min-height: 40px; display: flex; align-items: center; justify-content: center; }

        .payment-status { display: flex; gap: 8px; margin-bottom: 12px; }
        .pay-box { flex: 1; padding: 10px 5px; border-radius: 15px; background: #f8f9fa; font-size: 10px; font-weight: 700; border: 1px solid #eee; }
        .reste-txt { color: var(--danger); display: block; font-weight: 800; margin-top: 3px; }

        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 50px; color: white; font-size: 9px; font-weight: bold; }
        .bg-red { background: var(--danger); }
        .bg-green { background: var(--primary); }

        .btn-wave { width: 100%; margin-top: 15px; padding: 12px; border-radius: 15px; border: none; background: #e3f2fd; color: #1976d2; font-weight: 800; cursor: pointer; }
        
        /* ZONE ADMIN */
        .admin-zone { margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ccc; display: flex; flex-direction: column; gap: 5px; }
        .admin-input { padding: 8px; border-radius: 10px; border: 1px solid #ddd; text-align: center; font-family: inherit; }
        .btn-save { background: var(--primary); color: white; border: none; padding: 8px; border-radius: 10px; cursor: pointer; font-weight: bold; }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal-content { background: white; width: 85%; max-width: 350px; border-radius: 25px; padding: 25px; text-align: center; color: #333; }
        
        #loader { position: fixed; top: 15px; left: 50%; transform: translateX(-50%); background: #27ae60; color: white; padding: 8px 20px; border-radius: 50px; font-size: 12px; font-weight: bold; display: none; z-index: 3000; }
    </style>
</head>
<body>

<div id="loader">üîÑ ENREGISTREMENT...</div>

<header>
    <img src="images/A.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=D&background=fff&color=2ecc71'">
    <h1>DAARA AL MOUSTAKHIMOUNA</h1>
    <img src="images/A.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=D&background=fff&color=2ecc71'">
</header>

<div class="container">
    <div class="live-status"><span class="dot"></span> SYNC EN DIRECT (1s)</div>

    <div class="stats-grid">
        <div class="stat-card">
            <h4 style="margin:0; font-size: 12px; opacity: 0.8;">RESTE √Ä COLLECTER</h4>
            <div class="stat-value" id="detteGlobale">0 F</div>
        </div>
        <div class="stat-card">
            <h4 style="margin:0; font-size: 12px; opacity: 0.8;">TOTAL ENCAISS√â</h4>
            <div class="stat-value" id="totalEncaisse" style="color:#2ecc71">0 F</div>
        </div>
    </div>

    <div class="admin-top-bar">
        <button onclick="toggleAdmin()" id="adminBtn" class="btn-admin-toggle">üîê ACC√àS RESPONSABLE</button>
    </div>

    <input type="text" id="searchInput" class="search-bar" onkeyup="filterCards()" placeholder="üîç Rechercher un nom...">
    <div class="members-grid" id="membersGrid"></div>
</div>

<div class="modal-overlay" id="waveModal">
    <div class="modal-content">
        <h3 style="color:#1976d2">üåä Transfert Wave</h3>
        <div style="text-align:left; background:#f1f2f6; padding:15px; border-radius:15px; font-size:12px; line-height: 1.8;">
            Seydou Sall : <b>77 462 95 28</b><br>
            Malick Sarr : <b>78 122 37 73</b><br>
            Ibrahima Sanokho : <b>77 256 70 34</b><br>
            Khadidiatou Sall : <b>78 787 01 58</b>
        </div>
        <button onclick="closeWave()" style="margin-top:20px; padding:10px 30px; border-radius:50px; border:none; background:#2d3436; color:white; cursor:pointer; font-weight:bold;">FERMER</button>
    </div>
</div>

<script>
    const API_URL = "https://api.npoint.io/cf1eee9c96d506fc8eef";
    const SECRET = "1234ABCD@";
    const OBJ = 10000;
    let isAdmin = false;
    let dataStore = [];
    let currentSearch = "";

    const noms = ["Dieuwrigne Omar Ndaw", "Dieuwrigne Abdou Khoudoss Ngom", "Dieuwrigne Cheikh Ciss√©", "Dieuwrigne Malick Sarr", "Dieuwrigne Madiagne Sidib√©", "Dieuvrigne Abdoulaye Sall", "Dieuwrigne Idrissa ben Abdoulaye Diouf", "Dieuwrigne Ibrahima Sanokho", "Dieuwrigne Moussa Sarr", "Dieuwrigne Cheikh Sall", "Dieuwrigne Ousmane Sall", "Dieuwrigne Mouhamed Ngom", "Dieuwrigne Omar Sanokho Al Farokh", "Diewrigne Ousmane Sanokho", "Dieuwrigne Mamadou FALL", "Dieuwrigne Birane Diop", "Dieuwrigne Bassirou Ciss√©", "Dieuwrigne Pape Mass√©ne S√©ne", "Dieuwrigne Ibrahima diarra", "Dieuwrigne Mamady Fall Ndaw", "Dieuwrigne Seydou Sall", "Dieuwrigne Mouhamed Sall", "Dieuwrigne Cheikh Mback√©", "Dieuwrigne Sidi Sall", "Dieuwrigne Pape Sow sall", "Dieuwrigne Fallou Diop", "Dieuwrigne Mouhamed Diao", "Dieuwrigne Saliou Seck", "Sokhna Di√©yenaba Diop", "Sokhna Safi√©tou Sarr", "Sokhna Khadidiatou Sall", "Sokhna Adama Sarr", "Sokhna Nd√©ye Mbaye", "Sokhna Nd√©ye Camara", "Sokhna Awa Yacine Fall", "Sokhna Paya Tour√©", "Sokhna Sofia Diao", "Sokhna Ya Mari√©me Sall", "Sokhna Fily Traor√©", "Sokhna Fatou Camara", "Sokhna Rokhaya Sall", "Sokhna Awa Camara"];

    async function fetchData() {
        try {
            const r = await fetch(`${API_URL}?t=${new Date().getTime()}`);
            const newData = await r.json();
            if (JSON.stringify(newData) !== JSON.stringify(dataStore)) {
                dataStore = Array.isArray(newData) ? newData : [];
                render();
            }
        } catch (e) { console.log("Sync..."); }
    }

    async function pushData() {
        document.getElementById('loader').style.display = 'block';
        try {
            await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataStore)
            });
        } catch (e) { alert("Erreur d'envoi"); }
        setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 600);
    }

    function render() {
        const grid = document.getElementById('membersGrid');
        grid.innerHTML = '';
        let totalReste = 0, totalPaye = 0;

        noms.forEach((nom, i) => {
            const id = i + 1;
            const p = dataStore.find(x => x.id === id) || { id, a: 0, q: 0 };
            const dA = Math.max(0, OBJ - p.a);
            const dQ = Math.max(0, OBJ - p.q);
            const reste = dA + dQ;
            const status = reste <= 0 ? {cl: "bg-green", bdr: "border-green", txt: "√Ä JOUR ‚úÖ"} : {cl: "bg-red", bdr: "border-red", txt: "RETARD üî¥"};

            totalReste += reste; totalPaye += (p.a + p.q);

            if (nom.toLowerCase().includes(currentSearch.toLowerCase())) {
                grid.innerHTML += `
                    <div class="member-card">
                        <img src="images/A.jpeg" class="card-logo" onerror="this.src='https://ui-avatars.com/api/?name=D&background=2ecc71&color=fff'">
                        <div class="photo-container ${status.bdr}">
                            <img src="images/membre${id}.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(nom)}&background=random&size=200'">
                        </div>
                        <div class="member-name">${nom}</div>
                        <div class="payment-status">
                            <div class="pay-box">ADYYA<br>${p.a}F <span class="reste-txt">-${dA}F</span></div>
                            <div class="pay-box">QUINZAINE<br>${p.q}F <span class="reste-txt">-${dQ}F</span></div>
                        </div>
                        <span class="status-badge ${status.cl}">${status.txt}</span>
                        ${isAdmin ? `
                            <div class="admin-zone">
                                <input type="number" id="a${id}" class="admin-input" placeholder="+ Adyya">
                                <button onclick="updatePay(${id},'a')" class="btn-save">OK</button>
                                <input type="number" id="q${id}" class="admin-input" placeholder="+ Quin">
                                <button onclick="updatePay(${id},'q')" class="btn-save">OK</button>
                            </div>
                        ` : `<button class="btn-wave" onclick="openWave()">INFOS PAIEMENT</button>`}
                    </div>
                `;
            }
        });
        document.getElementById('detteGlobale').innerText = totalReste.toLocaleString() + " F";
        document.getElementById('totalEncaisse').innerText = totalPaye.toLocaleString() + " F";
    }

    async function updatePay(id, type) {
        let valField = document.getElementById(`${type}${id}`);
        let v = parseInt(valField.value) || 0;
        let m = dataStore.find(x => x.id === id);
        if (!m) { m = { id, a: 0, q: 0 }; dataStore.push(m); }
        m[type] += v;
        valField.value = "";
        render();
        await pushData();
    }

    function filterCards() { currentSearch = document.getElementById('searchInput').value; render(); }

    function toggleAdmin() {
        if (!isAdmin) {
            if (prompt("Code secret :") === SECRET) { isAdmin = true; document.getElementById('adminBtn').innerText = "üîì QUITTER ADMIN"; render(); }
        } else { isAdmin = false; document.getElementById('adminBtn').innerText = "üîê ACC√àS RESPONSABLE"; render(); }
    }

    function openWave() { document.getElementById('waveModal').style.display = 'flex'; }
    function closeWave() { document.getElementById('waveModal').style.display = 'none'; }

    fetchData(); 
    setInterval(fetchData, 1000);
</script>
</body>
</html>
