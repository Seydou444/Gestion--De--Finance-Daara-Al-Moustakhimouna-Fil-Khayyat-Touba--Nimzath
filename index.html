<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>DAARA AL MOUSTAKHIMOUNA | Officiel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root {
    --wave-blue: #1dcaff;
    --primary: #27ae60;
    --danger: #e74c3c;
    --dark: #2d3436;
    --warning: #3498db;
}
body { font-family: 'Poppins', sans-serif; background: purple; margin: 0; min-height: 100vh; }
header { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: linear-gradient(90deg, #3498db, #2ecc71); color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
header h1 { flex: 1; text-align: center; font-size: 18px; font-weight: 800; margin: 0; }
header img { height: 60px; width: 60px; border-radius: 12px; border: 2px solid yellowgreen; object-fit: cover; }
.container { max-width: 1300px; margin: 30px auto; padding: 0 20px; }

/* INDICATEUR LIVE AJOUT√â */
.live-status { text-align: center; color: white; font-size: 12px; margin-bottom: 10px; font-weight: 600; }
.dot { height: 10px; width: 10px; background-color: #00ff00; border-radius: 50%; display: inline-block; margin-right: 5px; animation: blink 1s infinite; }
@keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 25px; }
.stat-card { background: blueviolet; padding: 20px; border-radius: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); color:white; }
.stat-value { font-size: 1.4rem; font-weight: 800; color: var(--wave-blue); }
.stat-letters { font-size: 0.85rem; font-style: italic; color: #fdfdfd; margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 5px; text-transform: capitalize; }
.admin-only-stats { display: none; }
.admin-top-bar { text-align: center; margin-bottom: 30px; background:red; padding: 20px; border-radius: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; align-items: center; gap: 10px; }
.search-bar { width: 100%; max-width: 500px; display: block; margin: 0 auto 40px auto; padding: 15px 25px; border-radius: 50px; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.2); font-size: 16px; outline: none; }
.members-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(310px, 1fr)); gap: 30px; }
.member-card { background:bisque; border-radius: 35px; padding: 45px 20px 25px 20px; text-align: center; transition: 0.4s; box-shadow: 0 12px 35px rgba(0,0,0,0.1); position: relative; overflow: hidden; }
.card-logo { position: absolute; top: 10px; right: 10px; width: 65px; height: 65px; border-radius: 15px; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); object-fit: cover; z-index: 10; }
.photo-container { width: 160px; height: 160px; margin: 15px auto 20px auto; border-radius: 50%; border: 8px solid #eee; box-shadow: 0 10px 25px rgba(0,0,0,0.15); overflow: hidden; background: #f8f9fa; }
.border-green { border-color: var(--primary) !important; }
.border-blue { border-color: var(--warning) !important; }
.border-red { border-color: var(--danger) !important; }
.photo-container img { width: 100%; height: 100%; object-fit: cover; object-position: center 15%; transition: transform 0.5s ease; }
.member-name { font-size: 20px; font-weight: 800; margin-bottom: 20px; color: var(--dark); min-height: 50px; display: flex; align-items: center; justify-content: center; }
.payment-status { display: flex; gap: 8px; }
.pay-box { flex: 1; padding: 12px 5px; border-radius: 22px; background: #f8f9fa; font-size: 11px; font-weight: 700; color: #333; line-height: 1.5; }
.reste-txt { color: var(--danger); font-size: 12px; display: block; margin-top: 2px; border-top: 1px solid #ddd; padding-top: 2px; }
.status-badge { display: inline-block; padding: 4px 10px; border-radius: 50px; color: white; font-size: 9px; margin-top: 5px; }
.bg-red { background: var(--danger); }
.bg-blue { background: #3498db; }
.bg-green { background: var(--primary); }
.btn-wave { width: 100%; margin-top: 20px; padding: 14px; border-radius: 18px; border: none; background: var(--wave-blue); color: red; font-weight: 800; cursor: pointer; }
.admin-zone { margin-top: 15px; display: flex; flex-direction: column; gap: 8px; border-top: 1px dashed #ccc; padding-top: 15px; }
.admin-input { padding: 10px; border-radius: 12px; border: 1px solid #ddd; text-align: center; font-family: 'Poppins'; }
.btn-save { background: var(--primary); color: white; border: none; padding: 10px; border-radius: 12px; cursor: pointer; font-weight: 700; }
.btn-reset { background: white; color: red; border: 2px solid white; padding: 8px 20px; border-radius: 50px; cursor: pointer; font-weight: 800; font-size: 12px; margin-top: 10px; display: none; }
#loader { font-weight: 800; color: var(--primary); text-align: center; display: none; margin-bottom: 15px; background: #eefdf4; padding: 10px; border-radius: 10px; }
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(10px); }
.modal-content { background: white; width: 90%; max-width: 400px; border-radius: 40px; padding: 40px; text-align: center; }
.wave-item { display: flex; justify-content: space-between; padding: 15px 10px; border-bottom: 1px solid #f0f0f0; }
</style>
</head>
<body>

<header>
<img src="images/A.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=D&background=fff&color=2ecc71'">
<h1>GESTION DE FINANCE DAARA AL MOUSTAKHIMOUNA FIL KHAYAT TOUBA NIMZATH</h1>
<img src="images/A.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=D&background=fff&color=2ecc71'">
</header>

<div class="container">
<div class="live-status"><span class="dot"></span> MODE EN DIRECT ACTIF (1s)</div>
<div id="loader">üîÑ SYNCHRONISATION...</div>

<div class="stats-grid">
    <div class="stat-card">
        <h3>Reste Total √† payer</h3>
        <div class="stat-value" id="detteGlobale">-</div>
        <div class="stat-letters" id="detteEnLettres">Z√©ro Franc CFA</div>
    </div>
    <div class="stat-card admin-only-stats" id="cardAdyya"><h3>Objectif Adyya</h3><div class="stat-value" id="totalAdyya">- / 420000F</div></div>
    <div class="stat-card admin-only-stats" id="cardQuinzaine"><h3>Objectif Quinzaines</h3><div class="stat-value" id="totalQuinzaine">- / 420000F</div></div>
</div>

<div class="admin-top-bar">
<button onclick="toggleAdmin()" id="adminBtn" style="padding: 14px 30px; border-radius: 50px; border: none; background: var(--dark); color: white; font-weight: 800; cursor: pointer;">üîê ESPACE RESPONSABLE</button>
<button onclick="initialiserTout()" id="resetBtn" class="btn-reset">‚ö†Ô∏è INITIALISER TOUT √Ä 0 F</button>
</div>

<input type="text" id="searchInput" class="search-bar" onkeyup="filterCards()" placeholder="üîç Rechercher un membre...">
<div class="members-grid" id="membersGrid"></div>
</div>

<div class="modal-overlay" id="waveModal">
<div class="modal-content">
<h2 style="color:var(--wave-blue); margin-top:0;">üåä Paiement Wave</h2>
<div class="wave-item"><span>Seydou Sall</span> <strong>77 462 95 28</strong></div>
<div class="wave-item"><span>Malick Sarr</span> <strong>78 122 37 73</strong></div>
<div class="wave-item"><span>Ibrahima Sanokho</span> <strong>77 256 70 34</strong></div>
<div class="wave-item"><span>Khadidiatou Sall</span> <strong>78 787 01 58</strong></div>
<button onclick="closeWave()" style="margin-top:25px; padding:12px 40px; border-radius:50px; border:none; background:var(--dark); color:white; cursor:pointer; font-weight:800;">RETOUR</button>
</div>
</div>

<script>
const API_URL = "https://api.npoint.io/cf1eee9c96d506fc8eef";
const SECRET = "1234ABCD@";
const OBJ = 10000;
let isAdmin = false;
let dataStore = [];
let currentFilter = "";

const noms = ["Dieuwrigne Omar Ndaw","Dieuwrigne Abdou Khoudoss Ngom","Dieuwrigne Cheikh Ciss√©","Dieuwrigne Malick Sarr","Dieuwrigne Madiagne Sidib√©","Dieuvrigne Abdoulaye Sall","Dieuwrigne Idrissa ben Abdoulaye Diouf","Dieuwrigne Ibrahima Sanokho","Dieuwrigne Moussa Sarr","Dieuwrigne Cheikh Sall","Dieuwrigne Ousmane Sall","Dieuwrigne Mouhamed Ngom","Dieuwrigne Omar Sanokho Al Farokh","Diewrigne Ousmane Sanokho","Dieuwrigne Mamadou FALL","Dieuwrigne Birane Diop","Dieuwrigne Bassirou Ciss√©","Dieuwrigne Pape Mass√©ne S√©ne","Dieuwrigne Ibrahima diarra","Dieuwrigne Mamady Fall Ndaw","Dieuwrigne Seydou Sall","Dieuwrigne Mouhamed Sall","Dieuwrigne Cheikh Mback√©","Dieuwrigne Sidi Sall","Dieuwrigne Pape Sow sall","Dieuwrigne Fallou Diop","Dieuwrigne Mouhamed Diao","Dieuwrigne Saliou Seck","Sokhna Di√©yenaba Diop","Sokhna Safi√©tou Sarr","Sokhna Khadidiatou Sall","Sokhna Adama Sarr","Sokhna Nd√©ye Mbaye","Sokhna Nd√©ye Camara","Sokhna Awa Yacine Fall","Sokhna Paya Tour√©","Sokhna Sofia Diao","Sokhna Ya Mari√©me Sall","Sokhna Fily Traor√©","Sokhna Fatou Camara","Sokhna Rokhaya Sall","Sokhna Awa Camara"];

function nombreEnLettres(nombre){
    if(nombre<=0) return "z√©ro Franc CFA";
    const unites=["","un","deux","trois","quatre","cinq","six","sept","huit","neuf"];
    const dizaines=["","dix","vingt","trente","quarante","cinquante","soixante","soixante-dix","quatre-vingt","quatre-vingt-dix"];
    const exception={11:"onze",12:"douze",13:"treize",14:"quatorze",15:"quinze",16:"seize"};
    function convertir(n){
        if(n<10) return unites[n];
        if(n>=11 && n<=16) return exception[n];
        if(n<100){ let d=Math.floor(n/10); let u=n%10; if(d===7||d===9) return dizaines[d-1]+"-"+(u===1?"et-":"")+convertir(u+10); return dizaines[d]+(u===1?"-et-":(u>0?"-":""))+unites[u];}
        if(n<1000){ let c=Math.floor(n/100); let reste=n%100; return (c===1?"":unites[c]+" ")+"cent"+(reste>0?" "+convertir(reste):"");}
        if(n<1000000){ let m=Math.floor(n/1000); let reste=n%1000; return (m===1?"":convertir(m)+" ")+"mille"+(reste>0?" "+convertir(reste):"");}
        return n;
    }
    return convertir(nombre)+" Francs CFA";
}

// R√âCUP√âRATION ULTRA-RAPIDE AVEC ANTI-CACHE
async function fetchData(){
    try{
        const r = await fetch(API_URL + "?t=" + new Date().getTime());
        const newData = await r.json();
        
        // On ne met √† jour l'affichage que si les donn√©es ont chang√©
        if(JSON.stringify(newData) !== JSON.stringify(dataStore)){
            dataStore = newData;
            if(!Array.isArray(dataStore)) dataStore = [];
            render();
        }
    }catch(e){console.error("Erreur de synchro");}
}

async function pushData(){
    document.getElementById('loader').style.display='block';
    try{ 
        await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(dataStore)});
    }catch(e){alert("Erreur de connexion");}
    document.getElementById('loader').style.display='none';
}

async function initialiserTout(){
    if(confirm("ATTENTION : Cela va remettre TOUS les paiements √† 0 F. Confirmer ?")){
        dataStore = noms.map((nom,i)=>({id:i+1,a:0,q:0}));
        render();
        await pushData();
    }
}

function toggleAdmin(){
    const stats=document.querySelectorAll('.admin-only-stats');
    const rBtn=document.getElementById('resetBtn');
    if(!isAdmin){
        if(prompt("Code secret :")===SECRET){ 
            isAdmin=true; render();
            document.getElementById('adminBtn').style.background="#e74c3c";
            stats.forEach(s=>s.style.display='block');
            rBtn.style.display='inline-block';
        }
    }else{ 
        isAdmin=false; render();
        document.getElementById('adminBtn').style.background="#2d3436";
        stats.forEach(s=>s.style.display='none');
        rBtn.style.display='none';
    }
}

async function updatePay(id,type){
    let valField=document.getElementById(`${type}${id}`);
    let v=parseInt(valField.value)||0;
    let m=dataStore.find(x=>x.id===id);
    if(!m){ m={id:id,a:0,q:0}; dataStore.push(m);}
    m[type]+=v;
    if(m[type]<0) m[type]=0;
    valField.value="";
    render();
    await pushData();
}

function getStatus(reste){
    if(reste<=0) return {cl:"bg-green",bdr:"border-green",txt:"PAY√â ‚úÖ"};
    if(reste<=5000) return {cl:"bg-blue",bdr:"border-blue",txt:"BIENT√îT üîµ"};
    return {cl:"bg-red",bdr:"border-red",txt:"RETARD üî¥"};
}

function render(){
    let rT=0,eA=0,eQ=0;
    const grid = document.getElementById('membersGrid');
    grid.innerHTML = "";

    noms.forEach((nom,i)=>{
        const id=i+1;
        const p=dataStore.find(x=>x.id===id)||{id:id,a:0,q:0};
        const dA=Math.max(0,OBJ-p.a);
        const dQ=Math.max(0,OBJ-p.q);
        const resteInd=dA+dQ;
        const status=getStatus(resteInd);
        rT+=resteInd; eA+=p.a; eQ+=p.q;
        
        // Gestion du filtre de recherche
        const isVisible = nom.toLowerCase().includes(currentFilter.toLowerCase());

        grid.innerHTML += `
        <div class="member-card" style="display: ${isVisible ? 'block' : 'none'}">
            <img src="images/A.jpeg" class="card-logo" onerror="this.src='https://ui-avatars.com/api/?name=D&background=fff&color=2ecc71'">
            <div class="photo-container ${status.bdr}">
                <img src="images/membre${id}.jpeg" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(nom)}&background=random&size=250'">
            </div>
            <div class="member-name">${nom}</div>
            <div class="payment-status">
                <div class="pay-box">
                    ADYYA<br>${p.a} / ${OBJ} F
                    <span class="reste-txt">Reste: ${dA} F</span>
                    <span class="status-badge ${getStatus(dA).cl}">${getStatus(dA).txt}</span>
                </div>
                <div class="pay-box">
                    QUINZAINE<br>${p.q} / ${OBJ} F
                    <span class="reste-txt">Reste: ${dQ} F</span>
                    <span class="status-badge ${getStatus(dQ).cl}">${getStatus(dQ).txt}</span>
                </div>
            </div>
            ${isAdmin ? `
                <div class="admin-zone">
                    <input type="number" id="a${id}" class="admin-input" placeholder="+/- Adyya">
                    <button onclick="updatePay(${id},'a')" class="btn-save">MODIFIER</button>
                    <input type="number" id="q${id}" class="admin-input" placeholder="+/- Quinzaine">
                    <button onclick="updatePay(${id},'q')" class="btn-save">MODIFIER</button>
                </div>
            ` : `
                <button class="btn-wave" onclick="document.getElementById('waveModal').style.display='flex'">INFOS PAIEMENT</button>
            `}
        </div>`;
    });

    document.getElementById('detteGlobale').innerText = rT.toLocaleString() + " F";
    document.getElementById('detteEnLettres').innerText = nombreEnLettres(rT);
    document.getElementById('totalAdyya').innerText = eA.toLocaleString() + " / 420000F";
    document.getElementById('totalQuinzaine').innerText = eQ.toLocaleString() + " / 420000F";
}

function filterCards(){
    currentFilter = document.getElementById('searchInput').value;
    render();
}

function closeWave(){ document.getElementById('waveModal').style.display='none'; }

// D√âMARRAGE DU MODE LIVE 1 SECONDE
fetchData();
setInterval(fetchData, 1000);

</script>
</body>
</html>